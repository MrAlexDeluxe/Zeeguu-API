<!DOCTYPE html>
<meta charset="utf-8">

<head>
    <link rel="stylesheet" type="text/css"
          href=" {{ url_for('static', filename='css/graphs/learner_statistics_piechart/learner_statistics_piechart.css') }} ">
</head>

<body>

<script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>

<script>

    var learner_statistics_data = [
        {
            "label": "Not Encountered",
            "value": {{ estimator.get_not_encountered_words_count() }}
        },
        {
            "label": "Known",
            "value": {{ estimator.get_not_looked_up_words_count() }}
        },
        {
            "label": "Learned",
            "value": {{ estimator.get_known_bookmarks_count() + estimator.get_probably_known_words_count() }}
        },
        {
            "label": "Learning",
            "value": {{ user.bookmark_count() }}
        }
    ];

    var width = 560;
    var height = 360;
    var radius = Math.min(width, height) / 2;
    var pie_slice_color = d3.scale.ordinal()
            .domain([0, 1 , 2 , 3])
            .range([ '#c7c7c7', '#2AE816' , '#9AFF0B' , '#FFD918']);

    var pie_graph = d3.select('pie_graph')
            .append("svg:svg")
            .data([learner_statistics_data])
            .attr("width", width)
            .attr("height", height)
            .append("svg:g")
            .attr("class", "pie_graph")
            .attr("transform", "translate(" + radius + "," + radius + ")");

    var pie = d3.layout.pie().value(function (entry) {
        return entry.value;
    });

    // declare an arc generator function
    // circular arc is a curved boundary of length L from a circular sector(slice).
    var arc = d3.svg.arc()
            .innerRadius(radius * 0.65)  // NEW
            .outerRadius(radius);

    // select paths, use arc generator to draw
    var arcs = pie_graph.selectAll("g.slice")
            .data(pie).enter()
            .append("svg:g")
            .attr("class", "arc");

    // draw the slices
    arcs.append("svg:path")
            .attr("fill", function (entry, index) {
                return pie_slice_color(index);
            })
            .attr("d", function (entry) {
                return arc(entry);
            });


    // add legends
    var legendRectSize = 18;
    var legendSpacing = 4;

    var legend = pie_graph.selectAll('.legend')
            .data(pie_slice_color.domain())
            .enter()
            .append('g')
            .attr('class', 'legend')
            .attr('transform', function (d, i) {
                var height = legendRectSize + legendSpacing;
                var offset = height * pie_slice_color.domain().length / 2;
                var horz = 12 * legendRectSize;
                var vert = i * height - offset;
                return 'translate(' + horz + ',' + vert + ')';
            });

    legend.append('rect')
            .attr('width', legendRectSize)
            .attr('height', legendRectSize)
            .style('fill', pie_slice_color)
            .style('stroke', pie_slice_color);

    legend.append('text')
            .attr('x', legendRectSize + legendSpacing)
            .attr('y', legendRectSize - legendSpacing)
            .text(function (index) {
                return learner_statistics_data[index].label;
            });


    // add tooltips
    var tooltip = d3.select('pie_graph')
            .append('div')
            .attr('class', 'pie_tooltip');

    tooltip.append('div')
            .attr('class', 'name');

    tooltip.append('div')
            .attr('class', 'value');

    tooltip.append('div')
            .attr('class', 'percent');

    var path = pie_graph.selectAll('path');

    path.on('mouseover', function (entry) {
        var total = d3.sum(learner_statistics_data.map(function (entry) {
            return entry.value;
        }));
        var percent = Math.round(1000 * entry.data.value / total) / 10;
        tooltip.select('.name').html(entry.data.label);
        tooltip.select('.value').html(entry.data.value);
        tooltip.select('.percent').html(percent + '%');
        tooltip.style('display', 'inline-block');
    });

    path.on('mouseout', function () {
        tooltip.style('display', 'none');
    });


    // add title
    pie_graph.append("text")
        .attr("x", 0)
        .attr("y", 0)
        .attr("text-anchor", "middle")
        .style("fill", "#606060")
        .style("font-size", "23px")
        .style("font-weight", "bold")
        .style("font-family", "'Arial', Gadget, sans-serif")
        .text(function () {
                var total = d3.sum(learner_statistics_data.map(function (entry) {
                    return entry.value;
                }));
                return "Top " + total + " Words ";
            });


</script>